# Born2beroot
project based on knowing how the virtualization work


my notes :

b2b project

1 - partitioning and installation 
mohabid pass : BobbyBlunders3

2 - sudo command doesn't exist : 
su -

apt install sudo

3 - add a user to sudo grp :sudo visudo

%sudo   ALL=(ALL:ALL) ALL
mohabid   ALL=(root) NOPASSWD /usr/local/bin/monitoring.sh (the user mohabid can excute the monitoring.sh script with no need to enter password after using sudo)

sudo nano
create sexyppl group command : sudo groupadd sexyppl

add to a user to a group : sudo usermod -aG sexyppl mohabid

delete a user from a group : sudo deluser sexyppl mohabid

delete user's group : sudo groupdel mohabid

create the user's group with the same gid = sudo groupadd -g GID groupname(you don't need this just info)

run the command (id) to see the users and groups infos or (cat /etc/group)

4 - SSH setup :

 I -  Install openSSH server : 

sudo apt update

sudo apt install openssh-server

II -  Configure SSH to use port 4242

sudo nano /etc/ssh/sshd_config (port 22 to 4242)

permitRootLogin no

You have to configure your operating system with the UFW (or firewalld for Rocky)
firewall and thus leave only port 4242 open : 

sudo ufw default deny incoming

sudo ufw default allow outgoing

sudo ufw allow 4242

sudo ufw enable

sudo ufw status verbose

sudo systemctl restart sshd

sudo lsof -i -n -P | grep LISTEN // verify 4242 port active

from another machine : ssh -p 4242 mohabid@127.0.0.2


III -The use of SSH will be tested during the defense by setting up a new account. You must therefore understand how it works:

sudo adduser simo (create a user)

hostname -i(lowercase i to take server ip) output = 127.0.0.1 (but if you do in your browser localhost:4242 it is taken by a site with no purpose this is why you need to setup NAT as host port = 127.0.0.2)


IV - Change of the hostname to mohabid42 :
sudo hostnamectl set-hostname mohabid42
and sudo nano /etc/hosts change the second line (after localhost to your login42)

5 : password policy configuration :

I - sudo apt install libpam-pwquality

II - sudo nano /etc/pam.d/common-password

password        requisite                       pam_pwquality.so retry=3 minlen=10 lcredit=-1 dcredit=-1 ucredit=-1 maxrepeat=3 reject_username difok=7 enforce_for_root

sudo nano etc/login.defs

PASS_MAX_DAYS 30 // pass day expiration

PASS_MIN_DAYS 2 // min day for new pass

PASS_WARN_AGE 7 // basically 23 days then you get a pass warning

sudo chage --maxdays 30 --mindays 2 --warndays 7 mohabid // change manually

chage -l mohabid // check age

III - sudo nano /etc/sudoers (or sudo visudo)

Defaults        logfile="/var/log/sudo/sudo.log"

Defaults        passwd_tries=3

Defaults        requiretty

Defaults        secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin"

Defaults        badpass_message="your costum message here"

Defaults        log_input, log_output

6 - each action using sudo has to be archieved, both inputs and outputs in the logfile /var/log/sudo/sudo.log

Defaults log_input, log_output

Defaults logfile="/var/log/sudo/sudo.log"

 log_input: This option logs all input (commands) that are executed with sudo.
 
  log_output: This option logs all output generated by those commands.
  
  logfile: This specifies the path to your custom log file.

7 - monitoring script :
#!/bin/bash

arch=$(uname -a)

cpuf=$(grep "physical id" /proc/cpuinfo | wc -l)

cpuv=$(grep "processor" /proc/cpuinfo | wc -l)

ram_total=$(free --mega | awk '$1 == "Mem:" {print $2}')
ram_use=$(free --mega | awk '$1 == "Mem:" {print $3}')
ram_percent=$(free --mega | awk '$1 == "Mem:" {printf("%.2f"), $3/$2*100}')

disk_total=$(df -m | grep "/dev/" | grep -v "/boot" | awk '{disk_t += $2} END {printf ("%.1fGb\n"), disk_t/1024}')
disk_use=$(df -m | grep "/dev/" | grep -v "/boot" | awk '{disk_u += $3} END {print disk_u}')
disk_percent=$(df -m | grep "/dev/" | grep -v "/boot" | awk '{disk_u += $3} {disk_t+= $2} END {printf("%d"), disk_u/disk_t*100}')

cpul=$(vmstat 1 2 | tail -1 | awk '{printf $15}')
cpu_op=$(expr 100 - $cpul)
cpu_fin=$(printf "%.1f" $cpu_op)

lb=$(who -b | awk '$1 == "system" {print $3 " " $4}')

lvmu=$(if [ $(lsblk | grep "lvm" | wc -l) -gt 0 ]; then echo yes; else echo no; fi)

tcpc=$(ss -ta | grep ESTAB | wc -l)

ulog=$(users | wc -w)

ip=$(hostname -I)
mac=$(ip link | grep "link/ether" | awk '{print $2}')

cmnd=$(journalctl _COMM=sudo | grep COMMAND | wc -l)

wall "  Architecture: $arch
        CPU physical: $cpuf
        vCPU: $cpuv
        Memory Usage: $ram_use/${ram_total}MB ($ram_percent%)
        Disk Usage: $disk_use/${disk_total} ($disk_percent%)
        CPU load: $cpu_fin%
        Last boot: $lb
        LVM use: $lvmu
        Connections TCP: $tcpc ESTABLISHED
        User log: $ulog
        Network: IP $ip ($mac)
        Sudo: $cmnd cmd"

Create a service file for your script:

crontab -e // add excutable command

*/10 * * * * bash /usr/local/bin/monitoring.sh

crontab -l // see your scheduled tasks

crontab -r // remove services

8- bonus 
sudo apt-get update

sudo apt-get upgrade

sudo apt-get install lighttpd

sudo systemctl start lighttpd

sudo systemctl enable lighttpd

sudo nano /etc/lighttpd/lighttpd.conf

server.port                 = 8080 (you can use the default 80 )

sudo apt-get install php php-cgi php-fpm php-mysql -y
sudo lighty-enable-mod fastcgi
sudo lighty-enable-mod fastcgi-php
sudo systemctl restart lighttpd
sudo apt-get install mariadb-server mariadb-client -y
sudo systemctl start mariadb
sudo systemctl enable mariadb
sudo mysql_secure_installation
sudo mysql -u root -p
CREATE DATABASE mohabid;
CREATE USER 'mohabid'@'localhost' IDENTIFIED BY 'Ilikemy123@';
GRANT ALL PRIVILEGES ON mohabid.* TO 'mohabid'@'localhost';
FLUSH PRIVILEGES;
EXIT;
cd /var/www/html/
sudo wget https://wordpress.org/latest.tar.gz
sudo tar -xvzf latest.tar.gz
sudo mv wordpress/* ./
sudo rm -rf wordpress latest.tar.gzwww-data:
sudo chown -R www-data /var/www/html/
sudo chmod -R 755 /var/www/html/
sudo nano /var/www/html/wordpress/wp-config.php
{
define( 'DB_NAME', 'wordpress' );
define( 'DB_USER', 'mohabid' );
define( 'DB_PASSWORD', 'simosimo' );
define( 'DB_HOST', 'localhost' );
define( 'DB_CHARSET', 'utf8' );
define( 'DB_COLLATE', '' );
}
sudo systemctl restart lighttpd
xdg-open localhost:8080
wget localhost:8080
cat /var/www/html/index.html
