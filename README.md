# Born2beroot
project based on knowing how the virtualization work


my notes :

b2b project

1 - partitioning and installation 
mohabid pass : BobbyBlunders3

2 - sudo command doesn't exist : 
su -

apt install sudo

3 - add a user to sudo grp :sudo visudo

# User privilege specification
root    ALL=(ALL:ALL) ALL
mohabid ALL=(ALL:ALL) ALL

# Allow members of group sudo to execute any command
%sudo   ALL=(ALL:ALL) ALL
mohabid   ALL=(root) NOPASSWD /usr/local/bin/monitoring.sh (the user mohabid can excute the monitoring.sh script with no need to enter password after using sudo)

create sexyppl group command : sudo groupadd sexyppl

add to a user to a group : sudo usermod -aG sexyppl mohabid

delete a user from a group : sudo deluser sexyppl mohabid

delete user's group : sudo groupdel mohabid

create the user's group with the same gid = sudo groupadd -g GID groupname(you don't need this just info)

run the command (id) to see the users and groups infos or (cat /etc/group)

4 - SSH setup :

 I -  Install openSSH server : 

sudo apt update

sudo apt install openssh-server

II -  Configure SSH to use port 4242

sudo nano /etc/ssh/sshd_config (port 22 to 4242)

permitRootLogin no

You have to configure your operating system with the UFW (or firewalld for Rocky)
firewall and thus leave only port 4242 open : 

sudo ufw default deny incoming

sudo ufw default allow outgoing

sudo ufw allow 4242

sudo ufw enable

sudo ufw status verbose

sudo systemctl restart sshd

sudo lsof -i -n -P | grep LISTEN // verify 4242 port active

from another machine : ssh -p 4242 mohabid@127.0.0.2


III -The use of SSH will be tested during the defense by setting up a new account. You must therefore understand how it works:

sudo adduser simo (create a user)

hostname -i(lowercase i to take server ip) output = 127.0.0.1 (but if you do in your browser localhost:4242 it is taken by a site with no purpose this is why you need to setup NAT as host port = 127.0.0.2)


IV - Change of the hostname to mohabid42 :

sudo hostnamectl set-hostname mohabid42

and sudo nano /etc/hosts change the second line (after localhost to your login42)

5 : password policy configuration :

I - sudo apt install libpam-pwquality

II - sudo nano /etc/pam.d/common-password

password        requisite                       pam_pwquality.so retry=3 minlen=10 lcredit=-1 dcredit=-1 ucredit=-1 maxrepeat=3 reject_username difok=7 enforce_for_root

sudo nano etc/login.defs

PASS_MAX_DAYS 30 // pass day expiration

PASS_MIN_DAYS 2 // min day for new pass

PASS_WARN_AGE 7 // basically 23 days then you get a pass warning

sudo chage --maxdays 30 --mindays 2 --warndays 7 mohabid // change manually

chage -l mohabid // check age

III - sudo nano /etc/sudoers (or sudo visudo)

Defaults        logfile="/var/log/sudo/sudo.log"

Defaults        passwd_tries=3

Defaults        requiretty

Defaults        secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin"

Defaults        badpass_message="your costum message here"

Defaults        log_input, log_output

6 - each action using sudo has to be archieved, both inputs and outputs in the logfile /var/log/sudo/sudo.log

Defaults log_input, log_output

Defaults logfile="/var/log/sudo/sudo.log"

 log_input: This option logs all input (commands) that are executed with sudo.
 
  log_output: This option logs all output generated by those commands.
  
  logfile: This specifies the path to your custom log file.

7 - monitoring script :

Create a service file for your script:

crontab -e // add excutable command

*/10 * * * * bash /usr/local/bin/monitoring.sh

crontab -l // see your scheduled tasks

crontab -r // remove services

8- bonus 
sudo apt-get update

sudo apt-get upgrade

sudo apt-get install lighttpd

sudo systemctl start lighttpd

sudo systemctl enable lighttpd

sudo nano /etc/lighttpd/lighttpd.conf

server.port                 = 8080 (you can use the default 80 )

sudo apt-get install php php-cgi php-fpm php-mysql -y

sudo lighty-enable-mod fastcgi

sudo lighty-enable-mod fastcgi-php

sudo systemctl restart lighttpd

sudo apt-get install mariadb-server mariadb-client -y

sudo systemctl start mariadb

sudo systemctl enable mariadb

sudo mysql_secure_installation

sudo mysql -u root -p
{// lets call this 1

CREATE DATABASE mohabid;

CREATE USER 'mohabid'@'localhost' IDENTIFIED BY 'Ilikemy123@';

GRANT ALL PRIVILEGES ON mohabid.* TO 'mohabid'@'localhost';

FLUSH PRIVILEGES;

EXIT;

}

cd /var/www/html/

sudo wget https://wordpress.org/latest.tar.gz

sudo tar -xvzf latest.tar.gz

sudo mv wordpress/* ./

sudo rm -rf wordpress latest.tar.gzwww-data:

sudo chown -R www-data /var/www/html/

sudo chmod -R 755 /var/www/html/

sudo nano /var/www/html/wordpress/wp-config.php (if you don't have this file you have to copy the  /var/www/html/wordpress/wp-config-sample.php and rename it to wp-config.php in the www/html/wordpress directory)

{// do the same config s you did in 1 (sudo mysql -u root -p command)

define( 'DB_NAME', 'mohabid' );

define( 'DB_USER', 'mohabid' );

define( 'DB_PASSWORD', 'Ilikemy123@' );

define( 'DB_HOST', 'localhost' );

define( 'DB_CHARSET', 'utf8' );

define( 'DB_COLLATE', '' );
}

sudo systemctl restart lighttpd

now you go to your browser open search bar and type localhost:8080 should be able to access your wordpress.
